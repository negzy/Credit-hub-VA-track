<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VA Command Center</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #000;
            color: #fff;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: #ff6600;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-align: center;
        }

        h2 {
            color: #ff6600;
            margin: 30px 0 15px 0;
            font-size: 1.8em;
            border-bottom: 2px solid #ff6600;
            padding-bottom: 10px;
        }

        h3 {
            color: #ff8800;
            margin: 20px 0 10px 0;
            font-size: 1.3em;
        }

        .section {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .today-tasks {
            background: #1a1a1a;
            border: 2px solid #ff6600;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .task-item {
            background: #2a2a2a;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #ff6600;
            border-radius: 4px;
        }

        .task-item.completed {
            opacity: 0.6;
            border-left-color: #666;
        }

        .task-time {
            color: #ff8800;
            font-weight: bold;
            margin-right: 10px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .queue-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9em;
        }

        .queue-table th {
            background: #ff6600;
            color: #000;
            padding: 12px;
            text-align: left;
            font-weight: bold;
        }

        .queue-table td {
            padding: 10px;
            border-bottom: 1px solid #333;
        }

        .queue-table tr:hover {
            background: #2a2a2a;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .status-new { background: #ff6600; color: #000; }
        .status-in-progress { background: #ffaa00; color: #000; }
        .status-done { background: #00aa00; color: #fff; }
        .priority-high { color: #ff4444; font-weight: bold; }
        .priority-med { color: #ffaa00; }
        .priority-low { color: #888; }

        .template-box {
            background: #2a2a2a;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #ff6600;
        }

        .template-title {
            color: #ff8800;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .template-content {
            background: #1a1a1a;
            padding: 12px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.5;
            cursor: pointer;
            position: relative;
        }

        .template-content:hover {
            background: #252525;
        }

        .copy-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #ff6600;
            color: #000;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: bold;
        }

        .copy-btn:hover {
            background: #ff8800;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .metric-box {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 4px;
            text-align: center;
            border: 1px solid #ff6600;
        }

        .metric-label {
            color: #aaa;
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .metric-value {
            color: #ff6600;
            font-size: 2em;
            font-weight: bold;
        }

        .guidelines-box {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 4px;
            border-left: 4px solid #ff6600;
            margin-top: 15px;
        }

        .guidelines-box h4 {
            color: #ff8800;
            margin-bottom: 10px;
        }

        .add-item-btn {
            background: #ff6600;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
        }

        .add-item-btn:hover {
            background: #ff8800;
        }

        .admin-only { display: none; }
        body.admin-mode .admin-only { display: table-cell; }
        .status-cell { min-width: 5em; }
        .status-select {
            width: 100%;
            min-width: 6em;
            background: #1a1a1a;
            color: #fff;
            border: 1px solid #333;
            padding: 6px 8px;
            border-radius: 4px;
            font-size: 0.9em;
            cursor: pointer;
        }
        .delete-row-btn {
            background: #cc2222;
            color: #fff;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
        }
        .delete-row-btn:hover { background: #ff4444; }
        .mark-done-btn {
            background: #00aa00;
            color: #fff;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
        }
        .mark-done-btn:hover { background: #00cc00; }
        .for-emmanuel-box {
            background: #1a1a2e;
            border: 2px solid #0066aa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        .for-emmanuel-box h2 { color: #0066aa; }
        .va-identity-box {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 6px;
            padding: 12px 16px;
            margin-bottom: 15px;
        }
        .shift-time-box {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 6px;
            padding: 12px 16px;
            margin-bottom: 20px;
            font-size: 0.9em;
        }
        .shift-time-row {
            display: flex;
            gap: 10px;
            margin-bottom: 8px;
        }
        .shift-label {
            color: #aaa;
        }
        .report-box {
            background: #0a0a0a;
            border: 2px solid #00aa00;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 0.85em;
            max-height: 400px;
            overflow-y: auto;
        }
        .report-actions { margin-top: 10px; }

        .handoff-box {
            background: #1a3a1a;
            border: 2px solid #00aa00;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }

        .handoff-box h3 {
            color: #00ff00;
        }

        textarea {
            width: 100%;
            background: #1a1a1a;
            color: #fff;
            border: 1px solid #333;
            padding: 10px;
            border-radius: 4px;
            font-family: inherit;
            font-size: 0.95em;
            min-height: 100px;
            resize: vertical;
        }

        input[type="text"], input[type="number"], select {
            background: #1a1a1a;
            color: #fff;
            border: 1px solid #333;
            padding: 8px;
            border-radius: 4px;
            font-family: inherit;
            width: 100%;
        }

        .placeholder-note {
            color: #666;
            font-style: italic;
            padding: 20px;
            text-align: center;
            border: 2px dashed #333;
            border-radius: 4px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ VA Command Center</h1>

        <div class="va-identity-box">
            <label style="color: #aaa;">I am:</label>
            <select id="va-name" onchange="saveVAName();" style="margin-left: 8px; padding: 6px 12px; background: #1a1a1a; color: #fff; border: 1px solid #ff6600; border-radius: 4px; font-size: 1em;">
                <option value="">‚Äî Select ‚Äî</option>
                <option value="Elmo">Elmo</option>
                <option value="Soc">Soc</option>
            </select>
            <span style="color: #666; margin-left: 12px; font-size: 0.9em;">(Report will say "Report from: [your name]". To add more VAs: edit this file and add an option.)</span>
        </div>

        <div class="shift-time-box">
            <h3 style="color: #ff8800; margin-bottom: 8px;">‚è± Shift time</h3>
            <p style="color: #aaa; margin-bottom: 8px;">Click <strong>Clock In</strong> at the start of your 2-hour shift and <strong>Clock Out</strong> at the end.</p>
            <div class="shift-time-row">
                <button type="button" class="add-item-btn" style="padding: 6px 14px;" onclick="clockIn()">Clock In</button>
                <button type="button" class="add-item-btn" style="padding: 6px 14px; background: #333; color: #fff;" onclick="clockOut()">Clock Out</button>
            </div>
            <p class="shift-label">Clock in: <span id="clock-in-display">‚Äî</span></p>
            <p class="shift-label">Clock out: <span id="clock-out-display">‚Äî</span></p>
            <p class="shift-label">Duration: <span id="clock-duration-display">‚Äî</span></p>
        </div>

        <!-- Today's 2-Hour Plan -->
        <div class="today-tasks">
            <h2>üìã Today's 2-Hour Plan</h2>
            <div id="today-tasks-list">
                <div class="task-item" data-task="notifications">
                    <span class="task-time">10 min</span>
                    <strong>Check notifications and tag anything urgent</strong>
                    <input type="checkbox" onchange="toggleTask(this)" style="float: right; width: 20px; height: 20px;">
                </div>
                <div class="task-item" data-task="comments">
                    <span class="task-time">30 min</span>
                    <strong>Reply to unanswered comments in Skool (Engagement Queue)</strong>
                    <input type="checkbox" onchange="toggleTask(this)" style="float: right; width: 20px; height: 20px;">
                </div>
                <div class="task-item" data-task="welcome">
                    <span class="task-time">30 min</span>
                    <strong>Welcome + onboarding (welcome new members, point them to Start Here / Credit GPS, answer questions)</strong>
                    <input type="checkbox" onchange="toggleTask(this)" style="float: right; width: 20px; height: 20px;">
                </div>
                <div class="task-item" data-task="dms">
                    <span class="task-time">30 min</span>
                    <strong>Emmanuel Admin DMs (DM Queue + follow-ups)</strong>
                    <input type="checkbox" onchange="toggleTask(this)" style="float: right; width: 20px; height: 20px;">
                </div>
                <div class="task-item" data-task="post">
                    <span class="task-time">20 min</span>
                    <strong>Post one engagement prompt OR bump an existing thread (add a GIF)</strong>
                    <input type="checkbox" onchange="toggleTask(this)" style="float: right; width: 20px; height: 20px;">
                </div>
                <div class="task-item" data-task="metrics">
                    <span class="task-time">5 min</span>
                    <strong>Update quick metrics + leave handoff note</strong>
                    <input type="checkbox" onchange="toggleTask(this)" style="float: right; width: 20px; height: 20px;">
                </div>
            </div>
            <button class="add-item-btn" onclick="resetDailyTasks()">üîÑ Reset Daily Tasks</button>
        </div>

        <!-- Engagement Queue -->
        <div class="section">
            <h2>üí¨ Engagement Queue (Skool Comments)</h2>
            <p style="color: #aaa; margin-bottom: 15px;">Track comments that need replies. Add items (+ Add Comment), edit any cell, set Status to <strong>New</strong> / <strong>In Progress</strong> / <strong>Done</strong>. Use Delete if you added a row by mistake.</p>
            <table class="queue-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Link</th>
                        <th>Member</th>
                        <th>Topic</th>
                        <th>Priority</th>
                        <th>Status</th>
                        <th>Response Type</th>
                        <th>Notes</th>
                        <th>Mark done</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody id="engagement-queue">
                    <tr>
                        <td colspan="10" class="placeholder-note">No items yet. Add items manually below or import from Google Sheet.</td>
                    </tr>
                </tbody>
            </table>
            <button class="add-item-btn" onclick="addEngagementItem()">+ Add Comment</button>
        </div>

        <!-- DM + Follow-up Queue -->
        <div class="section">
            <h2>üì© DM + Follow-up Queue (Emmanuel Admin)</h2>
            <p style="color: #aaa; margin-bottom: 15px;">Track DMs and follow-ups. Add items (+ Add DM), edit any cell, update Status. Remember: ONE question only, then direct to next step. Use Delete for mistakes.</p>
            <table class="queue-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Platform</th>
                        <th>Name</th>
                        <th>What They Asked</th>
                        <th>Qualification</th>
                        <th>Next Action</th>
                        <th>Follow-up Date</th>
                        <th>Status</th>
                        <th>Notes</th>
                        <th>Mark done</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody id="dm-queue">
                    <tr>
                        <td colspan="11" class="placeholder-note">No items yet. Add items manually below or import from Google Sheet.</td>
                    </tr>
                </tbody>
            </table>
            <button class="add-item-btn" onclick="addDMItem()">+ Add DM</button>
        </div>

        <!-- Quick Metrics -->
        <div class="section">
            <h2>üìä Quick Metrics (Manual Update)</h2>
            <p style="color: #aaa; margin-bottom: 15px;">Update these numbers at end of shift (60 seconds).</p>
            <div class="metrics-grid">
                <div class="metric-box">
                    <div class="metric-label">New Members</div>
                    <div class="metric-value" contenteditable="true" onblur="saveMetrics()">0</div>
                </div>
                <div class="metric-box">
                    <div class="metric-label">Comments Replied</div>
                    <div class="metric-value" contenteditable="true" onblur="saveMetrics()">0</div>
                </div>
                <div class="metric-box">
                    <div class="metric-label">DMs Sent</div>
                    <div class="metric-value" contenteditable="true" onblur="saveMetrics()">0</div>
                </div>
                <div class="metric-box">
                    <div class="metric-label">Calls Booked</div>
                    <div class="metric-value" contenteditable="true" onblur="saveMetrics()">0</div>
                </div>
                <div class="metric-box">
                    <div class="metric-label">Upgrades</div>
                    <div class="metric-value" contenteditable="true" onblur="saveMetrics()">0</div>
                </div>
            </div>
        </div>

        <!-- Templates -->
        <div class="section">
            <h2>üìù Templates</h2>
            <p style="color: #aaa; margin-bottom: 15px;">Click template to copy. Edit templates in templates.txt file.</p>
            <div id="templates-container"></div>
        </div>

        <!-- Post Guidelines -->
        <div class="section">
            <h2>üìå Post Guidelines</h2>
            <p style="color: #aaa; margin-bottom: 15px;">Check these rules before posting in any group.</p>
            <div class="guidelines-box">
                <h4>Skool Community Rules</h4>
                <div id="skool-rules" contenteditable="true" style="min-height: 100px; padding: 10px; background: #1a1a1a; border-radius: 4px; margin-top: 10px;">
                    [Add Skool community rules here - do's and don'ts in one paragraph]
                </div>
            </div>
            <div class="guidelines-box" style="margin-top: 15px;">
                <h4>Emmanuel Admin Account Rules</h4>
                <div id="admin-rules" contenteditable="true" style="min-height: 100px; padding: 10px; background: #1a1a1a; border-radius: 4px; margin-top: 10px;">
                    [Add Emmanuel Admin account posting rules here - do's and don'ts in one paragraph]
                </div>
            </div>
        </div>

        <!-- Handoff Note -->
        <div class="handoff-box">
            <h3>üì§ End-of-Shift Handoff Note</h3>
            <p style="color: #aaa; margin-bottom: 10px;">Leave a note for Emmanuel about what was done and what needs attention.</p>
            <textarea id="handoff-note" placeholder="Example: Completed all comments in queue. 3 new DMs need follow-up tomorrow. 2 members asked about Credit GPS - sent links. One urgent question about funding timeline - needs your response."></textarea>
            <button class="add-item-btn" onclick="saveHandoff()" style="margin-top: 10px; background: #00aa00; color: #fff;">üíæ Save Handoff Note</button>
            <h4 style="color: #00ff00; margin-top: 20px; margin-bottom: 10px;">üìã Send to Emmanuel</h4>
            <p style="color: #aaa; margin-bottom: 10px;">At end of shift: generate report, copy it, and paste into the <strong>shared Doc</strong>. Same Doc for all VAs (Elmo, Soc, etc.) ‚Äî Emmanuel pastes the link in "For Emmanuel" below.</p>
            <button class="add-item-btn" onclick="generateReport()" style="background: #0066aa;">Generate report for Emmanuel</button>
            <div id="report-container" style="display: none;">
                <div id="report-output" class="report-box"></div>
                <div class="report-actions">
                    <button class="add-item-btn" id="copy-report-btn" onclick="copyReport()">Copy report</button>
                    <button class="add-item-btn" onclick="downloadReport()" style="background: #333;">Download as .txt</button>
                    <button class="add-item-btn" onclick="document.getElementById('report-container').style.display='none'" style="background: #333;">Close</button>
                </div>
            </div>
        </div>
        <p style="text-align: center; margin-top: 20px; color: #666; font-size: 0.9em;">
            <span class="admin-only"><strong>Admin mode on.</strong></span>
            <a href="#" id="admin-toggle" style="color: #666;" onclick="toggleAdmin(); return false;">Unlock admin</a>
        </p>

        <div class="for-emmanuel-box" style="margin-top: 30px;">
            <h2>üë§ For Emmanuel</h2>
            <p style="color: #888; font-size: 0.9em; margin-bottom: 8px;">One shared Doc for all VAs. Paste the link once; Elmo, Soc, and any future VAs all paste their reports into this same Doc.</p>
            <input type="url" id="emmanuel-doc-link" placeholder="Paste shared Doc link here" style="width: 100%; margin-top: 8px; padding: 10px; background: #1a1a1a; color: #fff; border: 1px solid #333; border-radius: 4px;">
            <button type="button" class="add-item-btn" onclick="openEmmanuelDoc()" style="margin-top: 10px; background: #0066aa;">Open shared Doc</button>
        </div>
    </div>

    <script>
        // Load templates
        function loadTemplates() {
            fetch('templates.txt')
                .then(response => response.text())
                .then(text => {
                    const templates = parseTemplates(text);
                    displayTemplates(templates);
                })
                .catch(() => {
                    // If templates.txt doesn't exist, show default templates
                    const defaultTemplates = {
                        'Welcome Message': 'Hey [Name]! Welcome to the community! üéâ I\'m so excited you\'re here. Make sure to check out the Start Here section and our Credit GPS tool at {{CREDIT_GPS_LINK}} - it\'s going to help you get started on the right foot. Feel free to drop any questions you have!',
                        'Comment Reply - General': 'Thanks for sharing that! That\'s a great question. Have you checked out our Credit GPS tool yet? It might help you get a clearer picture. Let me know if you need anything else!',
                        'DM Follow-up': 'Hey [Name]! Just following up on your question about [topic]. I wanted to make sure you got everything you needed. Are you ready to take the next step, or do you have any other questions?',
                        'Book a Call Redirect': 'That\'s awesome that you\'re ready to move forward! The best next step is to book a call with Emmanuel so he can give you personalized guidance. Here\'s the link: {{BOOKING_LINK}}. Looking forward to connecting!',
                        'Post Your Win': 'Hey everyone! üéâ Drop your wins below - big or small, we want to celebrate with you! What\'s something you\'ve accomplished this week that you\'re proud of?',
                        'Where Do I Start?': 'Great question! Start by checking out the Start Here section pinned at the top of the community. Then head over to our Credit GPS tool at {{CREDIT_GPS_LINK}} - it\'ll help you understand where you are and what your next steps should be. Once you\'ve done that, feel free to introduce yourself and let us know what you\'re working on!'
                    };
                    displayTemplates(defaultTemplates);
                });
        }

        function parseTemplates(text) {
            const templates = {};
            const sections = text.split(/^##\s+/m);
            sections.forEach(section => {
                if (section.trim()) {
                    const lines = section.split('\n');
                    const title = lines[0].trim();
                    const content = lines.slice(1).join('\n').trim();
                    if (title && content) {
                        templates[title] = content;
                    }
                }
            });
            return templates;
        }

        function displayTemplates(templates) {
            const container = document.getElementById('templates-container');
            container.innerHTML = '';
            Object.entries(templates).forEach(([title, content]) => {
                const box = document.createElement('div');
                box.className = 'template-box';
                box.innerHTML = `
                    <div class="template-title">${title}</div>
                    <div class="template-content" onclick="copyTemplate(this)">
                        ${content.replace(/\n/g, '<br>')}
                        <button class="copy-btn" onclick="event.stopPropagation(); copyTemplate(this.parentElement)">Copy</button>
                    </div>
                `;
                container.appendChild(box);
            });
        }

        function copyTemplate(element) {
            const text = element.textContent.replace('Copy', '').trim();
            navigator.clipboard.writeText(text).then(() => {
                const btn = element.querySelector('.copy-btn');
                const original = btn.textContent;
                btn.textContent = 'Copied!';
                btn.style.background = '#00aa00';
                setTimeout(() => {
                    btn.textContent = original;
                    btn.style.background = '#ff6600';
                }, 2000);
            });
        }

        function toggleTask(checkbox) {
            const taskItem = checkbox.closest('.task-item');
            if (checkbox.checked) {
                taskItem.classList.add('completed');
            } else {
                taskItem.classList.remove('completed');
            }
            saveTasks();
        }

        function resetDailyTasks() {
            if (confirm('Reset all daily tasks? This will uncheck everything.')) {
                document.querySelectorAll('#today-tasks-list input[type="checkbox"]').forEach(cb => {
                    cb.checked = false;
                    cb.closest('.task-item').classList.remove('completed');
                });
                saveTasks();
            }
        }

        function addEngagementItem() {
            const date = new Date().toLocaleDateString();
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${date}</td>
                <td contenteditable="true">[Paste link]</td>
                <td contenteditable="true">[Member name]</td>
                <td contenteditable="true">[Topic]</td>
                <td contenteditable="true">Low</td>
                <td class="status-cell"><select class="status-select" onchange="saveQueues()"><option value="New" selected>New</option><option value="In Progress">In Progress</option><option value="Done">Done</option></select></td>
                <td contenteditable="true">[Response type]</td>
                <td contenteditable="true">[Notes]</td>
                <td><button type="button" class="mark-done-btn" onclick="markRowDone(this, 'engagement')">‚úì Done</button></td>
                <td><button type="button" class="delete-row-btn" onclick="deleteQueueRow(this, 'engagement')">Delete</button></td>
            `;
            const tbody = document.getElementById('engagement-queue');
            if (tbody.querySelector('.placeholder-note')) {
                tbody.innerHTML = '';
            }
            tbody.appendChild(row);
            saveQueues();
        }

        function addDMItem() {
            const date = new Date().toLocaleDateString();
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${date}</td>
                <td contenteditable="true">Skool</td>
                <td contenteditable="true">[Name]</td>
                <td contenteditable="true">[What they asked]</td>
                <td contenteditable="true">New</td>
                <td contenteditable="true">[Next action]</td>
                <td contenteditable="true">[Follow-up date]</td>
                <td class="status-cell"><select class="status-select" onchange="saveQueues()"><option value="New" selected>New</option><option value="In Progress">In Progress</option><option value="Done">Done</option></select></td>
                <td contenteditable="true">[Notes]</td>
                <td><button type="button" class="mark-done-btn" onclick="markRowDone(this, 'dm')">‚úì Done</button></td>
                <td><button type="button" class="delete-row-btn" onclick="deleteQueueRow(this, 'dm')">Delete</button></td>
            `;
            const tbody = document.getElementById('dm-queue');
            if (tbody.querySelector('.placeholder-note')) {
                tbody.innerHTML = '';
            }
            tbody.appendChild(row);
            saveQueues();
        }

        function deleteQueueRow(btn, queue) {
            if (!confirm('Remove this row? (Use this if you added it by mistake.)')) return;
            btn.closest('tr').remove();
            const tbody = queue === 'engagement' ? document.getElementById('engagement-queue') : document.getElementById('dm-queue');
            if (tbody.querySelectorAll('tr').length === 0) {
                const placeholder = document.createElement('tr');
                placeholder.innerHTML = queue === 'engagement'
                    ? '<td colspan="10" class="placeholder-note">No items yet. Add items manually below or import from Google Sheet.</td>'
                    : '<td colspan="11" class="placeholder-note">No items yet. Add items manually below or import from Google Sheet.</td>';
                tbody.appendChild(placeholder);
            }
            saveQueues();
        }

        function markRowDone(btn, queue) {
            const row = btn.closest('tr');
            const statusIndex = queue === 'engagement' ? 5 : 7;
            const cells = row.querySelectorAll('td');
            const statusCell = cells[statusIndex];
            if (statusCell) {
                const sel = statusCell.querySelector('select.status-select');
                if (sel) sel.value = 'Done'; else statusCell.textContent = 'Done';
                saveQueues();
            }
        }

        function getCellValue(cell) {
            const sel = cell.querySelector('select.status-select');
            return sel ? sel.value : (cell.textContent || '').trim();
        }

        function saveTasks() {
            const tasks = {};
            document.querySelectorAll('#today-tasks-list .task-item').forEach(item => {
                const taskId = item.dataset.task;
                tasks[taskId] = item.querySelector('input').checked;
            });
            localStorage.setItem('va-tasks', JSON.stringify(tasks));
        }

        function loadTasks() {
            const saved = localStorage.getItem('va-tasks');
            if (saved) {
                const tasks = JSON.parse(saved);
                document.querySelectorAll('#today-tasks-list .task-item').forEach(item => {
                    const taskId = item.dataset.task;
                    if (tasks[taskId]) {
                        item.querySelector('input').checked = true;
                        item.classList.add('completed');
                    }
                });
            }
        }

        function saveQueues() {
            const engagementRows = [];
            document.querySelectorAll('#engagement-queue tr').forEach(row => {
                if (!row.querySelector('.placeholder-note')) {
                    const cells = Array.from(row.querySelectorAll('td')).slice(0, 8).map(cell => getCellValue(cell));
                    engagementRows.push(cells);
                }
            });
            localStorage.setItem('va-engagement-queue', JSON.stringify(engagementRows));

            const dmRows = [];
            document.querySelectorAll('#dm-queue tr').forEach(row => {
                if (!row.querySelector('.placeholder-note')) {
                    const cells = Array.from(row.querySelectorAll('td')).slice(0, 9).map(cell => getCellValue(cell));
                    dmRows.push(cells);
                }
            });
            localStorage.setItem('va-dm-queue', JSON.stringify(dmRows));
        }

        function loadQueues() {
            const engagement = localStorage.getItem('va-engagement-queue');
            if (engagement) {
                const rows = JSON.parse(engagement);
                const tbody = document.getElementById('engagement-queue');
                tbody.innerHTML = '';
                rows.forEach(cells => {
                    const row = document.createElement('tr');
                    const statusVal = (cells[5] || 'New').trim();
                    const statusOpt = function(v) { return '<option value="' + escapeHtml(v) + '"' + (statusVal === v ? ' selected' : '') + '>' + escapeHtml(v) + '</option>'; };
                    row.innerHTML = cells.map((cell, i) => {
                        if (i === 5) {
                            return '<td class="status-cell"><select class="status-select" onchange="saveQueues()">' + statusOpt('New') + statusOpt('In Progress') + statusOpt('Done') + '</select></td>';
                        }
                        return `<td contenteditable="true">${escapeHtml(cell || '')}</td>`;
                    }).join('') + '<td><button type="button" class="mark-done-btn" onclick="markRowDone(this, \'engagement\')">‚úì Done</button></td><td><button type="button" class="delete-row-btn" onclick="deleteQueueRow(this, \'engagement\')">Delete</button></td>';
                    tbody.appendChild(row);
                });
            }

            const dm = localStorage.getItem('va-dm-queue');
            if (dm) {
                const rows = JSON.parse(dm);
                const tbody = document.getElementById('dm-queue');
                tbody.innerHTML = '';
                rows.forEach(cells => {
                    const row = document.createElement('tr');
                    const statusVal = (cells[7] || 'New').trim();
                    const statusOpt = function(v) { return '<option value="' + escapeHtml(v) + '"' + (statusVal === v ? ' selected' : '') + '>' + escapeHtml(v) + '</option>'; };
                    row.innerHTML = cells.map((cell, i) => {
                        if (i === 7) {
                            return '<td class="status-cell"><select class="status-select" onchange="saveQueues()">' + statusOpt('New') + statusOpt('In Progress') + statusOpt('Done') + '</select></td>';
                        }
                        return `<td contenteditable="true">${escapeHtml(cell || '')}</td>`;
                    }).join('') + '<td><button type="button" class="mark-done-btn" onclick="markRowDone(this, \'dm\')">‚úì Done</button></td><td><button type="button" class="delete-row-btn" onclick="deleteQueueRow(this, \'dm\')">Delete</button></td>';
                    tbody.appendChild(row);
                });
            }
        }

        function escapeHtml(s) {
            const div = document.createElement('div');
            div.textContent = s;
            return div.innerHTML;
        }

        function saveMetrics() {
            const metrics = {};
            document.querySelectorAll('.metric-value').forEach((el, i) => {
                const label = el.previousElementSibling.textContent.trim();
                metrics[label] = el.textContent.trim();
            });
            localStorage.setItem('va-metrics', JSON.stringify(metrics));
        }

        function loadMetrics() {
            const saved = localStorage.getItem('va-metrics');
            if (saved) {
                const metrics = JSON.parse(saved);
                document.querySelectorAll('.metric-value').forEach(el => {
                    const label = el.previousElementSibling.textContent.trim();
                    if (metrics[label]) {
                        el.textContent = metrics[label];
                    }
                });
            }
        }

        function saveHandoff() {
            const note = document.getElementById('handoff-note').value;
            localStorage.setItem('va-handoff', note);
            alert('Handoff note saved!');
        }

        function loadHandoff() {
            const saved = localStorage.getItem('va-handoff');
            if (saved) {
                document.getElementById('handoff-note').value = saved;
            }
        }

        function saveGuidelines() {
            const skoolRules = document.getElementById('skool-rules').textContent;
            const adminRules = document.getElementById('admin-rules').textContent;
            localStorage.setItem('va-skool-rules', skoolRules);
            localStorage.setItem('va-admin-rules', adminRules);
        }

        function loadGuidelines() {
            const skoolRules = localStorage.getItem('va-skool-rules');
            const adminRules = localStorage.getItem('va-admin-rules');
            if (skoolRules) document.getElementById('skool-rules').textContent = skoolRules;
            if (adminRules) document.getElementById('admin-rules').textContent = adminRules;
        }

        function openEmmanuelDoc() {
            const url = document.getElementById('emmanuel-doc-link').value.trim();
            if (url) {
                window.open(url, '_blank');
            } else {
                alert('Paste your shared Google Doc link in the box above first.');
            }
        }

        function loadEmmanuelDocLink() {
            const saved = localStorage.getItem('va-emmanuel-doc-link');
            if (saved && document.getElementById('emmanuel-doc-link')) {
                document.getElementById('emmanuel-doc-link').value = saved;
            }
        }

        var ADMIN_PASS = 'admin'; // Change this in the file if you want a different passphrase

        function saveVAName() {
            var el = document.getElementById('va-name');
            if (el) localStorage.setItem('va-name', el.value);
        }
        function loadVAName() {
            var saved = localStorage.getItem('va-name');
            var el = document.getElementById('va-name');
            if (el && saved) el.value = saved;
        }

        function getShiftData() {
            const raw = localStorage.getItem('va-shift');
            if (!raw) return null;
            try {
                const data = JSON.parse(raw);
                const todayKey = new Date().toDateString();
                if (data.date !== todayKey) return null;
                return data;
            } catch {
                return null;
            }
        }

        function saveShiftData(data) {
            localStorage.setItem('va-shift', JSON.stringify(data));
        }

        function formatTimeShort(d) {
            return d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        function formatDuration(ms) {
            if (!ms || ms <= 0) return '‚Äî';
            const mins = Math.round(ms / 60000);
            const h = Math.floor(mins / 60);
            const m = mins % 60;
            if (h <= 0) return m + ' min';
            return h + 'h ' + m + 'm';
        }

        function updateShiftDisplay() {
            const data = getShiftData();
            const inEl = document.getElementById('clock-in-display');
            const outEl = document.getElementById('clock-out-display');
            const durEl = document.getElementById('clock-duration-display');
            if (!inEl || !outEl || !durEl) return;
            if (!data || !data.in) {
                inEl.textContent = '‚Äî';
                outEl.textContent = '‚Äî';
                durEl.textContent = '‚Äî';
                return;
            }
            const inDate = new Date(data.in);
            inEl.textContent = formatTimeShort(inDate);
            if (data.out) {
                const outDate = new Date(data.out);
                outEl.textContent = formatTimeShort(outDate);
                durEl.textContent = formatDuration(outDate - inDate);
            } else {
                outEl.textContent = '‚Äî';
                durEl.textContent = '‚Äî';
            }
        }

        function clockIn() {
            const todayKey = new Date().toDateString();
            let data = getShiftData() || { date: todayKey };
            if (data.in && !confirm('You already clocked in. Overwrite start time?')) {
                return;
            }
            const now = new Date();
            data.date = todayKey;
            data.in = now.toISOString();
            if (!data.out) data.out = null;
            saveShiftData(data);
            updateShiftDisplay();
        }

        function clockOut() {
            let data = getShiftData();
            if (!data || !data.in) {
                if (!confirm('No clock-in time recorded for today. Set clock-out only?')) return;
                const now = new Date();
                const todayKey = now.toDateString();
                data = { date: todayKey, in: null, out: now.toISOString() };
            } else {
                const now = new Date();
                data.out = now.toISOString();
            }
            saveShiftData(data);
            updateShiftDisplay();
        }

        function generateReport() {
            const date = new Date().toLocaleString();
            const vaName = (document.getElementById('va-name') && document.getElementById('va-name').value) || 'VA';
            const shift = getShiftData();
            let out = 'VA COMMAND CENTER ‚Äì END OF SHIFT REPORT\n';
            out += 'Report from: ' + vaName + '\n';
            out += 'Generated: ' + date + '\n\n';

            out += '--- SHIFT TIME ---\n';
            if (shift && shift.in) {
                const inDate = new Date(shift.in);
                out += 'Clock in: ' + formatTimeShort(inDate) + '\n';
                if (shift.out) {
                    const outDate = new Date(shift.out);
                    out += 'Clock out: ' + formatTimeShort(outDate) + '\n';
                    out += 'Duration: ' + formatDuration(outDate - inDate) + '\n';
                } else {
                    out += 'Clock out: (not recorded)\n';
                    out += 'Duration: ‚Äî\n';
                }
            } else {
                out += 'Clock in/out not recorded\n';
            }
            out += '\n';

            out += '--- TASKS COMPLETED ---\n';
            document.querySelectorAll('#today-tasks-list .task-item').forEach(item => {
                const name = item.querySelector('.task-time').nextSibling.textContent.trim();
                const done = item.querySelector('input').checked;
                out += (done ? '[x] ' : '[ ] ') + name + '\n';
            });
            out += '\n';

            out += '--- ENGAGEMENT QUEUE (Skool) ---\n';
            const engagementHeaders = 'Date | Link | Member | Topic | Priority | Status | Response type | Notes';
            out += engagementHeaders + '\n';
            document.querySelectorAll('#engagement-queue tr').forEach(row => {
                if (row.querySelector('.placeholder-note')) return;
                const cells = Array.from(row.querySelectorAll('td')).slice(0, 8).map(c => getCellValue(c));
                out += cells.join(' | ') + '\n';
            });
            out += '\n';

            out += '--- DM + FOLLOW-UP QUEUE ---\n';
            const dmHeaders = 'Date | Platform | Name | What they asked | Qualification | Next action | Follow-up date | Status | Notes';
            out += dmHeaders + '\n';
            document.querySelectorAll('#dm-queue tr').forEach(row => {
                if (row.querySelector('.placeholder-note')) return;
                const cells = Array.from(row.querySelectorAll('td')).slice(0, 9).map(c => getCellValue(c));
                out += cells.join(' | ') + '\n';
            });
            out += '\n';

            out += '--- QUICK METRICS ---\n';
            document.querySelectorAll('.metric-box').forEach(box => {
                const label = box.querySelector('.metric-label').textContent.trim();
                const value = box.querySelector('.metric-value').textContent.trim();
                out += label + ': ' + value + '\n';
            });
            out += '\n';

            out += '--- HANDOFF NOTE ---\n';
            out += (document.getElementById('handoff-note').value || '(none)') + '\n';

            document.getElementById('report-output').textContent = out;
            document.getElementById('report-container').style.display = 'block';
        }

        function copyReport() {
            const text = document.getElementById('report-output').textContent;
            const btn = document.getElementById('copy-report-btn');
            if (!btn) return;
            navigator.clipboard.writeText(text).then(() => {
                const orig = btn.textContent;
                btn.textContent = 'Copied!';
                setTimeout(() => { btn.textContent = orig; }, 2000);
            });
        }

        function downloadReport() {
            const text = document.getElementById('report-output').textContent;
            const blob = new Blob([text], { type: 'text/plain' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            var vaLabel = (document.getElementById('va-name') && document.getElementById('va-name').value) ? document.getElementById('va-name').value.replace(/\s+/g, '-') : 'VA';
            a.download = 'va-shift-report-' + new Date().toISOString().slice(0, 10) + '-' + vaLabel + '.txt';
            a.click();
            URL.revokeObjectURL(a.href);
        }

        function toggleAdmin() {
            if (document.body.classList.contains('admin-mode')) {
                document.body.classList.remove('admin-mode');
                sessionStorage.removeItem('va-admin');
                document.getElementById('admin-toggle').textContent = 'Unlock admin';
                return;
            }
            const pass = prompt('Admin passphrase:');
            if (pass === ADMIN_PASS) {
                document.body.classList.add('admin-mode');
                sessionStorage.setItem('va-admin', '1');
                document.getElementById('admin-toggle').textContent = 'Lock admin';
            } else if (pass !== null) {
                alert('Incorrect passphrase.');
            }
        }

        // Auto-save on content edit
        document.addEventListener('DOMContentLoaded', () => {
            loadTasks();
            loadQueues();
            loadMetrics();
            loadHandoff();
            loadGuidelines();
            loadTemplates();
            loadEmmanuelDocLink();
            loadVAName();
            updateShiftDisplay();
            var docLinkEl = document.getElementById('emmanuel-doc-link');
            if (docLinkEl) docLinkEl.addEventListener('blur', function() { localStorage.setItem('va-emmanuel-doc-link', this.value.trim()); });
            if (sessionStorage.getItem('va-admin') === '1') {
                document.body.classList.add('admin-mode');
                document.getElementById('admin-toggle').textContent = 'Lock admin';
            }

            // Auto-save queues on edit
            document.getElementById('engagement-queue').addEventListener('blur', saveQueues, true);
            document.getElementById('dm-queue').addEventListener('blur', saveQueues, true);

            // Auto-save guidelines
            document.getElementById('skool-rules').addEventListener('blur', saveGuidelines);
            document.getElementById('admin-rules').addEventListener('blur', saveGuidelines);
        });

        // Check if it's a new day and reset tasks
        const lastReset = localStorage.getItem('va-last-reset');
        const today = new Date().toDateString();
        if (lastReset !== today) {
            localStorage.setItem('va-last-reset', today);
            // Don't auto-reset, let user do it manually
        }
    </script>
</body>
</html>
